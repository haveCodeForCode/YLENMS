<!DOCTYPE html>
<html lang="zh_CN" xmlns:th="http://www.thymeleaf.org"
	xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<meta charset="utf-8">
<head>
<th:block th:include="include :: header('工艺修改')" />
</head>
<body class="gray-bg">

	<form class="form-horizontal m" id="form-product-add"
		target="hidden_frame" th:object="${technology1}">
		<input type="hidden" id="tblId" th:value="${id}"> 
		<input
			type="hidden" id="url" th:value="${url}"> 
		<input
			type="hidden" id="tbloptag" th:field="*{optag}">
		<input
			type="hidden" id="tblstatus" th:field="*{status}">
	    <input
			type="hidden" id="tblobject" th:object="${technology1}">
			<input
			type="hidden" id="tbldispatchOptag" th:value="${dispatchOptag}"> 
			<input
			type="hidden" id="dispatchID" th:value="${dispatchID}"> 
	
		<div>
			<div class="form-group">
				<label class="col-sm-2 control-label" style="text-align: right;">调度单号：</label>
				<div class="col-sm-8">
					<input id="dispatchid" name="dispatchid" class="form-control"
						type="text" th:field="*{dispatchid}">
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label" style="text-align: right;">品名：</label>
				<div class="col-sm-8">
					<input id="pdname" name="pdname" class="form-control" type="text"
						th:field="*{pdname}">
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label" style="text-align: right;">生产线：</label>
				<div class="col-sm-8">
					<input id="pdlineid" name="pdlineid" class="form-control" type="text"
						th:field="*{pdlineid}">
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label" style="text-align: right;">客户：</label>
				<div class="col-sm-8">
					<input id="customer" name="customer" class="form-control" type="text"
						th:field="*{customer}">
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label" style="text-align: right;">客户质量标准ID：</label>
				<div class="col-sm-8">
					<input id="qulityid" name="qulityid" class="form-control" type="text"
						th:field="*{qulityid}">
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label" style="text-align: right;">客户质量要求：</label>
				<div class="col-sm-8">
					<!-- <input id="optime" name="optime" class="form-control" type="text" th:field="*{qulity}"> -->
					<textarea id="qulity" name="qulity" class="form-control" rows="5"
						th:field="*{qulity}"></textarea>
				</div>
			</div>

			<div>
				<div class="form-group" id=falseression style="display: none;">
					<label class="col-sm-2 control-label" style="text-align: right;">退审原因：</label>
					<div class="col-sm-8">
						<!-- <input id="ression" name="ression" class="form-control" type="text" th:field="*{ression}"> -->
						<textarea id="auditcomment" name="auditcomment"
							class="form-control" rows="5" th:field="*{auditcomment}"></textarea>
					</div>
				</div>
			</div>

</div>
			<div class="form-group">
				<label class="col-sm-2 control-label" style="text-align: right;">工艺编号：</label>
				<div class="col-sm-8">
					<input id="totaltechnologysn" name="totaltechnologysn" class="form-control" type="text"
						th:field="*{totaltechnologysn}">
				</div>
				<!-- <button id="confirmButton" onclick="submitOpen();"
					class=" col-sm-1 btn btn-primary">详情</button> -->
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label" style="visibility: hidden;">xxxx</label>
				<div class="col-sm-8">
					<div class="select-info">
						<table id="bootstrap-table-opensn" class="table table-bordered"
							data-mobile-responsive="true" data-height="300"></table>
					</div>
				</div>
				<label class="col-sm-2 control-label" style="visibility: hidden;">xxxx</label>
			</div>

			

			<!--<div class="form-group">
				<label class="col-sm-2 control-label" style="visibility: hidden;">xxxx</label>
				<div class="col-sm-8">
					<div class="select-info">
						<table id="bootstrap-table-windsn" class="table table-bordered"
							data-mobile-responsive="true" data-height="300"></table>
					</div>
				</div>
				<label class="col-sm-2 control-label" style="visibility: hidden;">xxxx</label>
			</div>
			 <div class="form-group">
				<label class="col-sm-2 control-label" style="text-align: right;">质量编号：</label>
				<div class="col-sm-8">
					<input id="qualitysn" name="qualitysn" class="form-control"
						type="text" th:field="*{qualitysn}">
				</div>
				<button id="confirmButton" onclick="submitQuality();"
					class=" col-sm-1 btn btn-primary">详情</button>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label" style="visibility: hidden;">xxxx</label>
				<div class="col-sm-8">
					<div class="select-info">
						<table id="bootstrap-table-qualitysn" class="table table-bordered"
							data-mobile-responsive="true" data-height="300"></table>
					</div>
				</div>
				<label class="col-sm-2 control-label" style="visibility: hidden;">xxxx</label>
			</div> -->
			<div class="form-group">
				<label class="col-sm-2 control-label" style="text-align: right;">修改内容记录：</label>
				<div class="col-sm-8">
					<!-- <input id="optime" name="optime" class="form-control" type="text" th:field="*{chgcomment}"> -->
					<textarea id="chgcomment" name="chgcomment" class="form-control" rows="5"></textarea>
				</div>
			</div>
			<div class="form-group">
				<div class="form-control-static col-sm-offset-9">
					<button id="confirmButton" onclick="submitRession();"
						class="btn btn-primary">确认提交</button>
					<button onclick="$.modal.close()" class="btn btn-danger"
						type="button">关闭</button>
				</div>
			</div>
	</form>
	<div th:include="include::footer"></div>
	<iframe name='hidden_frame' id="hidden_frame" style="display: none"></iframe>
	<script type="text/javascript">
	function check()
	{
		var aa = document.getElementById("chgcomment").value;		
		if (aa=="")
		{
			return true;
		}else{
			return false;
		}
    }
		if ($('#tblId').val() == 0) {

			document.getElementById("confirmButton").style.display = "none";
		}

		if ($('#tbloptag').val() == 3 && $('#tblstatus').val() == 6) {

			document.getElementById("falseression").style.display = "block";
		}

		function submitQuality() {
			var id = document.getElementById('qualitysn').value;

			var url2 = ctx + "module/technology" + "/submitQuality/" + id;

			openTechnologyDetail("工艺质量详情", url2, 800, 800);

		}
		function submitOpen() {
			var id = document.getElementById('opensn').value;
			var url2 = ctx + "module/technology" + "/submitOpen/" + id;

			openTechnologyDetail("开清工艺详情", url2, 800, 800);

		}
		function submitComb() {
			var id = document.getElementById('combsn').value;
			var url2 = ctx + "module/technology" + "/submitComb/" + id;

			openTechnologyDetail("梳理工艺详情", url2, 800, 800);

		}
		function submitSpunlace() {
			var id = document.getElementById('spunlacesn').value;
			var url2 = ctx + "module/technology" + "/submitSpunlace/" + id;

			openTechnologyDetail("水刺工艺详情", url2, 800, 800);

		}
		function submitWind() {
			var id = document.getElementById('windsn').value;
			var url2 = ctx + "module/technology" + "/submitWind/" + id;

			openTechnologyDetail("卷绕工艺详情", url2, 800, 800);

		}
		function openTechnologyDetail(title, url, width, height) {

			layer.open({
				id : 'addMacode1',
				type : 2,
				area : [ width + "px", height + "px" ],
				fix : false,
				maxmin : true,
				shade : 0.3,
				title : title,
				content : url,
				end : function() {//layer.open关闭事件关闭事件

					//alert("页面关闭");
					// var	param={};
					//  param["status"] = 4;
					//  _bootstrap_search_tablename("#bootstrap-table",param);
				}
			})
		}

		function submitRession() {
			
			
			if(check()){
				$.modal.confirm("修改内容记录不允许为空");
			}else{
				var totaltechnologysn = $('#totaltechnologysn').val();
				var dispatchid = $('#dispatchid').val();
				var technology = $('#tblobject');
	            var dispatchOptag = $('#tbldispatchOptag').val();  
	            var dispatchID = $('#dispatchID').val()
	            
	            var chgcomment = $('#chgcomment').val();  
	           
				$.modal.confirm("是否提交此次修改？",
						function() {
							var url = ctx + "module/technology"
									+ "/submitTechnologyUpdate";
							var data = {
								// "technology" : technology,
								"dispatchid" : dispatchid,
								"dispatchOptag" : dispatchOptag,
								"dispatchID" : dispatchID,								
								"chgcomment" : chgcomment,
								"totaltechnologysn" : totaltechnologysn
								
							};
							// _ajax(url, data, "post");
							adjax_post(url, data, "post");

							//location.reload();
						})

			}
			
			
		}

		function adjax_post(url, data, type) {
			var config = {
				url : url,
				type : type,
				dataType : "json",
				data : data,
				async : false,
				success : function(result) {
					simpleSuccess(result);
				}
			};
			$.ajax(config)
		};
		/** 返回结果处理 */
		function simpleSuccess(result) {
			if (result.code == web_status.SUCCESS) {
				$.modal.alert(result.msg, modal_status.SUCCESS);
				$.modal.close();
			} else {
				$.modal.alert(result.msg, modal_status.FAIL);
			}
		}
	</script>
	
	<script>
		$(function() {
			var prefix = ctx + "module/technology";
			var qureyOpeningOptions = {
				url : prefix + "/qureyTotalTechnology",
				modalName : "工艺列表",
				search : false,
				showRefresh : false,
				download : false,
				showExport : false,
				showToggle : false,
				showColumns : false,
				 columns: [{
			            checkbox: true
			        },
					{
						field : 'id', 
						title : '序号',
		                visible : false   
					},
					{
						field : 'totaltechnologysn', 
						title : '工艺编号' 
					},
					{
						field : 'pdlineid', 
						title : '生产线号' 
					},
					{
						field : 'customer', 
						title : '客户' 
					},
					{
						field : 'pdname', 
						title : '品名' 
					},
					{
						field : 'qulityid', 
						title : '质量标准ID',
		                visible : false 
					},
					{
						field : 'qulity', 
						title : '质量描述',
		                visible : false
					},
	                {
	                    field : 'windspeed',
	                    title : '卷绕速度m/min'
	                },
					{
						field : 'optag', 
						title : '操作标记',
		                visible : false   
					},
					{
						field : 'auditflag', 
						title : '审核状态',
		                visible : false   
					},
					{
						field : 'ression', 
						title : '退审理由' ,
		                visible : false  
					},
					{
						field : 'opensn', 
						title : '开清编号',
		                visible : false   
					},
					{
						field : 'combsn', 
						title : '梳理编号',
		                visible : false   
					},
					{
						field : 'spunlacesn', 
						title : '水刺编号',
		                visible : false   
					},
					{
						field : 'windsn', 
						title : '卷绕编号',
		                visible : false   
					},
					{
						field : 'qualitysn', 
						title : '质量编号',
		                visible : false   
					},
					{
						field : 'creator', 
						title : '制表人',
		                visible : false 
					},
					{
						field : 'crttime', 
						title : '制表时间',
		                visible : false 
					},
					{
						field : 'changer', 
						title : '修改人',
		                visible : false 
					},
					{
						field : 'chgtime', 
						title : '修改时间',
		                visible : false 
					},
					{
						field : 'chgcomment', 
						title : '修改意见',
		                visible : false 
					},
					{
						field : 'auditor', 
						title : '审核人',
		                visible : false 
					},
					{
						field : 'audittime', 
						title : '审核时间',
		                visible : false 
					},
					{
						field : 'auditcomment', 
						title : '审核意见',
		                visible : false 
					},
					{
						field : 'status', 
						title : '状态' ,
	                    formatter : function(value, row, index) {
	                    	$('#status6').val(value);
	                        var b = _ajax_dict('tbl_technology_status', value.trim());
	                        return b;
	                    } ,
		                visible : false
					},
					{
						field : 'remark', 
						title : '备注',
		                visible : false 
					},
					{
						field : 'transflag', 
						title : '传输标志' ,
		                visible : false  
					},
						{
							title : '操作',
							align : 'center',
							formatter : function(value, row, index) {
								var actions = [];
								actions
										.push('<a class="btn btn-success btn-xs"  onclick="detail(\''
												+ row.id
												+ '\')"><i class="fa fa-edit"></i>详情</a> ');
								var par = row.pdname+"_"+row.pdlineid+"_"+row.customer+"_"+row.qulityid+"_"+row.qulity+"_"+row.totaltechnologysn;
								actions
										.push('<a class="btn btn-success btn-xs"  onclick="useOpenTechnology(\''
												+ par
												+ '\')"><i class="fa fa-edit"></i>使用</a> ');

								return actions.join('');
							}
						} ]
			};
			//$.table.init(options);
			
			_bootstrap_show(qureyOpeningOptions, "bootstrap-table-opensn");
			var param = {};
            param["status"] = 6;
            param["pdname"] = document.getElementById("pdname").value;
            param["customer"] = document.getElementById("customer").value;
           // param["qulityid"] = document.getElementById("qulityid").value;
            _bootstrap_search_tablename("#bootstrap-table-opensn", param);
		});
	

	

	

		function detail(id) {
			/* var strs = new Array();
			strs = id.split("_");
			id = strs[0]; */
			/* if (strs[1] == "质量") {
				var url2 = ctx + "module/techquality" + "/detail/" + id;

				openTechnologyDetail("工艺质量详情", url2, 800, 800);
			}
			if (strs[1] == "水刺") {
				var url2 = ctx + "module/spunlace" + "/detail/" + id;

				openTechnologyDetail("水刺工艺详情", url2, 800, 800);
			}
			if (strs[1] == "开清") { */
				var url2 = ctx + "module/technology" + "/technologyDetails2/" + id;

				openTechnologyDetail("工艺详情", url2, 800, 800);
			/* }
			if (strs[1] == "梳理") {
				var url2 = ctx + "module/comb" + "/detail/" + id;

				openTechnologyDetail("梳理工艺详情", url2, 800, 800);
			}
			if (strs[1] == "卷绕") {
				var url2 = ctx + "module/wind" + "/detail/" + id;

				openTechnologyDetail("卷绕工艺详情", url2, 800, 800);
			}
 */
		}
		function useQualityTechnology(qualitysn) {
			$.modal.confirm("是否使用所选择的工艺？", function() {
				$('#qualitysn').val(qualitysn);

			})
		}
		function useOpenTechnology(par) {
			$.modal.confirm("是否使用所选择的工艺？", function() {
				var arr=par.split("_");
				console.log("数据长度:"+arr.length);
				if(arr.length == 6){
					$('#pdname').val(arr[0]);
					$('#pdlineid').val(arr[1]);
					$('#customer').val(arr[2]);
					$('#qulityid').val(arr[3]);
					$('#qulity').val(arr[4]);
					$('#totaltechnologysn').val(arr[5]);
				}else{
					$.modal.confirm("工艺信息不完整");
				}
				

			})
		}
		function useSpunlaceTechnology(spunlacesn) {
			$.modal.confirm("是否使用所选择的工艺？", function() {
				$('#spunlacesn').val(spunlacesn);

			})
		}
		function useCombTechnology(combsn) {
			$.modal.confirm("是否使用所选择的工艺？", function() {
				$('#combsn').val(combsn);

			})
		}
		function useWindTechnology(windsn) {
			$.modal.confirm("是否使用所选择的工艺？", function() {
				$('#windsn').val(windsn);

			})
		}
		function openTechnologyDetail(title, url, width, height) {

			layer.open({
				id : 'addMacode',
				type : 2,
				area : [ width + "px", height + "px" ],
				fix : false,
				maxmin : true,
				shade : 0.3,
				title : title,
				content : url,
				end : function() {
					//layer.open关闭事件关闭事件

				}
			})
		}
	</script>
</body>
</html>